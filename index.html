<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AdrianPunks - About</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/market/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    /* Estilos base */
    :root {
      --bg-color: #ffffff;
      --text-color: #333333;
      --card-bg: #ffffff;
      --border-color: #dee2e6;
      --modal-bg: #ffffff;
      --modal-header-bg: #f8f9fa;
      --dropdown-bg: #ffffff;
      --dropdown-text: #333333;
      --badge-bg: #007bff;
      --badge-text: #ffffff;
      --list-group-bg: #ffffff;
      --list-group-text: #333333;
      --list-group-border: #dee2e6;
    }

    /* Estilos dark mode */
    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --text-color: #ffffff;
      --card-bg: #2d2d2d;
      --border-color: #404040;
      --modal-bg: #2d2d2d;
      --modal-header-bg: #1a1a1a;
      --dropdown-bg: #2d2d2d;
      --dropdown-text: #ffffff;
      --badge-bg: #0d6efd;
      --badge-text: #ffffff;
      --list-group-bg: #2d2d2d;
      --list-group-text: #ffffff;
      --list-group-border: #404040;
      --modal-text: #ffffff;
      --modal-border: #404040;
      --modal-input-bg: #1a1a1a;
      --modal-input-text: #ffffff;
      --modal-input-border: #404040;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    .container {
      background-color: var(--bg-color);
    }

    .card {
      background-color: var(--card-bg);
      border-color: var(--border-color);
      color: var(--text-color);
    }

    .card-title, .card-text {
      color: var(--text-color);
    }

    .text-muted {
      color: #a0a0a0 !important;
    }

    .modal-content {
      background-color: var(--modal-bg);
      color: var(--modal-text);
      border-color: var(--modal-border);
    }

    .modal-header {
      background-color: var(--modal-header-bg);
      border-bottom-color: var(--modal-border);
    }

    .modal-body {
      background-color: var(--modal-bg);
      color: var(--modal-text);
    }

    .modal-footer {
      background-color: var(--modal-bg);
      border-top-color: var(--modal-border);
    }

    .form-control {
      background-color: var(--modal-input-bg);
      color: var(--modal-input-text);
      border-color: var(--modal-input-border);
    }

    .form-control:focus {
      background-color: var(--modal-input-bg);
      color: var(--modal-input-text);
      border-color: var(--modal-input-border);
    }

    .dropdown-menu {
      background-color: var(--dropdown-bg);
      color: var(--dropdown-text);
    }

    .badge {
      background-color: var(--badge-bg);
      color: var(--badge-text);
    }

    .list-group-item {
      background-color: var(--list-group-bg);
      color: var(--list-group-text);
      border-color: var(--list-group-border);
    }

    /* Estilos para la página de información */
    .info-section {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }

    .featured-image {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      margin-bottom: 2rem;
    }

    .info-content {
      line-height: 1.6;
    }

    .info-content h2 {
      margin-bottom: 1.5rem;
    }

    .info-content p {
      margin-bottom: 1rem;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .info-card {
      padding: 1.5rem;
      border-radius: 10px;
      background-color: var(--card-bg);
      border: 1px solid var(--border-color);
    }

    .info-card h3 {
      margin-bottom: 1rem;
    }

    .info-card ul {
      padding-left: 1.5rem;
    }

    .info-card li {
      margin-bottom: 0.5rem;
    }

    @media (max-width: 768px) {
      .info-section {
        padding: 1rem;
      }
      
      .info-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <!-- Load ethers.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <!-- Include the menu -->
  <div id="menu-container"></div>
  <script>
    // Load the menu
    fetch('market/components/menu.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('menu-container').innerHTML = html;
        const script = document.createElement('script');
        script.src = 'market/components/menu.js';
        document.head.appendChild(script);
      })
      .catch(error => console.error('Error loading menu:', error));
  </script>

  <!-- Main Container -->
  <div class="container">
    <!-- Balance y Floor Offer Info -->
    <div class="info-section mb-4">
      <h2 id="tokenBalance" class="mb-2">Balance: Loading...</h2>
      <div id="floorOfferSection" class="text-secondary">
        <span id="floorOfferText">Highest floor offer: -- $ADRIAN</span>
      </div>
    </div>

    <!-- Project Information -->
    <div class="info-section">
      <img id="featuredImage" src="" alt="AdrianPunks Token #1" class="featured-image">
      
      <div class="info-content">
        <h2>Welcome to AdrianPunks</h2>
        <p>AdrianPunks is a unique NFT collection that combines digital art with blockchain technology. Each token in the collection is a one-of-a-kind piece of art, featuring distinctive traits and characteristics that make it truly special.</p>
        
        <div class="info-grid">
          <div class="info-card">
            <h3>Mint an AdrianPunk</h3>
            <ul>
              <li>Mint your own AdrianPunk</li>
              <li>Price: 100K $A</li>
              <li>Limited supply</li>
              <li><a href="/mint.html" class="btn btn-primary mt-2">Mint Now</a></li>
            </ul>
          </div>

          <div class="info-card">
            <h3>Collection Features</h3>
            <ul>
              <li>Limited edition collection</li>
              <li>Unique traits and attributes</li>
              <li>Rarity-based system</li>
              <li>Community-driven development</li>
            </ul>
          </div>
          
          <div class="info-card">
            <h3>Marketplace</h3>
            <ul>
              <li>Buy and sell NFTs</li>
              <li>Make offers on tokens</li>
              <li>Floor price tracking</li>
              <li>Real-time trading</li>
            </ul>
          </div>
          
          <div class="info-card">
            <h3>AdrianPunks Artist</h3>
            <ul>
              <li>Created by HalfXtiger</li>
              <li>Unique artistic vision</li>
              <li>Digital art specialist</li>
              <li><a href="https://x.com/halfxtiger" target="_blank" class="btn btn-outline-primary mt-2">Follow on X</a></li>
            </ul>
          </div>

          <div class="info-card">
            <h3>$ADRIAN Token</h3>
            <ul>
              <li>The original token that started it all</li>
              <li>Primary currency for minting and trading</li>
              <li>Used across AdrianGallery's ecosystem</li>
              <li>Integrated with multiple dApps</li>
            </ul>
          </div>
        </div>
        
        <h3 class="mt-4">About the Project</h3>
        <p>AdrianPunks was created with the vision of bringing together art enthusiasts and blockchain technology. Each token in the collection is carefully crafted with unique attributes, making them valuable digital assets in the NFT space.</p>
        
        <p>The project is built on the BASE blockchain, ensuring security and transparency for all transactions. Our marketplace provides a seamless experience for collectors to trade and interact with their digital assets.</p>
        
        <p>Join our growing community and become part of the AdrianPunks ecosystem today!</p>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Main Script -->
  <script>
    /*********** Global Variables and Contract Setup ***********/
    let provider, signer, userAccount;
    let tokenContract, marketplaceContract, newMarketplaceContract;
    let nftData = [];
    
    // Direcciones de contratos y ABIs
    const TOKEN_ADDRESS  = "0x7E99075Ce287F1cF8cBCAaa6A1C7894e404fD7Ea";
    const NFT_ADDRESS    = "0x79BE8AcdD339C7b92918fcC3fd3875b5Aaad7566";
    const NEW_MARKET_ADDRESS = "0x4B09395Dd0B826Ab3D54272D5dba6769D1640297";

    const TOKEN_ABI = [
      "function balanceOf(address account) view returns (uint256)",
      "function approve(address spender, uint256 amount) external returns (bool)",
      "function allowance(address owner, address spender) view returns (uint256)"
    ];
    
    const MARKET_ABI = [
      "function floorOffers(address, uint256) external view returns (uint256 offerAmount, address buyer, bool active)",
      "function setFloorOffer(address collection, uint256 offerAmount) external",
      "function withdrawFloorOffer(address collection) external"
    ];
    
    async function initContracts() {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        userAccount = await signer.getAddress();
        tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
        newMarketplaceContract = new ethers.Contract(NEW_MARKET_ADDRESS, MARKET_ABI, signer);
        await loadNFTData();
        updateTokenBalance();
        loadFloorOffer();
      } else {
        console.error("Ethereum provider not found.");
      }
    }

    async function loadNFTData() {
      try {
        const response = await fetch('/market/adrianpunks.json');
        const data = await response.json();
        nftData = data.collection;
        
        // Seleccionar un NFT aleatorio
        const randomIndex = Math.floor(Math.random() * nftData.length);
        const randomNFT = nftData[randomIndex];
        
        const featuredImage = document.getElementById('featuredImage');
        featuredImage.src = randomNFT.image;
        featuredImage.alt = `AdrianPunk #${randomNFT.id}`;
        
        // Inicializar contratos si hay wallet conectada
        if (window.ethereum) {
          await initContracts();
        }
      } catch (error) {
        console.error('Error loading NFT data:', error);
      }
    }
    
    async function updateTokenBalance() {
      try {
        const balanceRaw = await tokenContract.balanceOf(userAccount);
        const balance = parseFloat(ethers.utils.formatUnits(balanceRaw, 18));
        let formattedBalance = balance >= 1000000 ? (balance / 1000000).toFixed(1) + 'M' :
                              balance >= 1000 ? (balance / 1000).toFixed(1) + 'K' :
                              balance.toFixed(1);
        document.getElementById("tokenBalance").innerText = `Balance: ${formattedBalance} $ADRIAN`;
      } catch (error) {
        console.error("Error fetching token balance:", error);
        document.getElementById("tokenBalance").innerText = "Balance: Error";
      }
    }
    
    async function loadFloorOffer() {
      try {
        const floorOffer = await newMarketplaceContract.callStatic.floorOffers(NFT_ADDRESS, 0);
        const offerAmount = floorOffer.offerAmount;
        const floorSection = document.getElementById("floorOfferSection");
        if (offerAmount.gt(0)) {
          const formattedAmount = parseFloat(ethers.utils.formatUnits(offerAmount, 18));
          const displayAmount = formattedAmount >= 1000000 ? (formattedAmount / 1000000).toFixed(1) + 'M' :
                              formattedAmount >= 1000 ? (formattedAmount / 1000).toFixed(1) + 'K' :
                              formattedAmount.toFixed(1);
          document.getElementById("floorOfferText").innerText = `Highest floor offer: ${displayAmount} $ADRIAN`;
          floorSection.classList.remove("no-offer");
            } else {
          document.getElementById("floorOfferText").innerText = "Highest floor offer: 0 $ADRIAN";
          floorSection.classList.add("no-offer");
        }
      } catch (error) {
        console.error("Error loading floor offer:", error);
        document.getElementById("floorOfferText").innerText = "Highest floor offer: 0 $ADRIAN";
        document.getElementById("floorOfferSection").classList.add("no-offer");
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      // Cargar la imagen destacada inmediatamente
      await loadNFTData();
      
      // Inicializar contratos si hay una wallet conectada
      if (window.ethereum) {
        await initContracts();
      }
    });

    // Función para cambiar el tema
    function toggleTheme() {
      const html = document.documentElement;
      const themeButton = document.getElementById('themeButton');
      const themeButtonText = document.getElementById('themeButtonText');
      const isDark = html.getAttribute('data-theme') === 'dark';
      
      if (!isDark) {
        html.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        themeButtonText.textContent = 'LightMode';
        themeButton.classList.remove('btn-outline-dark');
        themeButton.classList.add('btn-dark');
      } else {
        html.removeAttribute('data-theme');
        localStorage.setItem('theme', 'light');
        themeButtonText.textContent = 'DarkMode';
        themeButton.classList.remove('btn-dark');
        themeButton.classList.add('btn-secondary');
      }
    }

    // Cargar el tema guardado
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      const html = document.documentElement;
      const themeButton = document.getElementById('themeButton');
      const themeButtonText = document.getElementById('themeButtonText');
      
      if (savedTheme === 'dark') {
        html.setAttribute('data-theme', 'dark');
        themeButtonText.textContent = 'LightMode';
        themeButton.classList.remove('btn-outline-dark');
        themeButton.classList.add('btn-dark');
      } else {
        themeButtonText.textContent = 'DarkMode';
        themeButton.classList.remove('btn-dark');
        themeButton.classList.add('btn-secondary');
      }
    });
  </script>
</body>
</html>