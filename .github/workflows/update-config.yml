name: Update Config with Secrets

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-config:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Generate supabase-config.js files (for deployment only)
      run: |
        # Generate market/supabase-config.js with values from GitHub Secrets
        cat > market/supabase-config.js << EOF
        // Auto-generated by GitHub Actions during deployment - DO NOT EDIT MANUALLY
        // This file is generated from GitHub Secrets and should not contain hardcoded values
        // Values are injected during deployment by GitHub Actions workflows
        window.SUPABASE_URL = '${{ secrets.SUPABASE_URL }}';
        window.SUPABASE_ANON_KEY = '${{ secrets.SUPABASE_ANON_KEY }}';
        window.ALCHEMY_API_KEY = '${{ secrets.ALCHEMY_API_KEY }}';
        EOF
        
        # Generate marketbackup/supabase-config.js with values from GitHub Secrets
        cat > marketbackup/supabase-config.js << EOF
        // Auto-generated by GitHub Actions during deployment - DO NOT EDIT MANUALLY
        // This file is generated from GitHub Secrets and should not contain hardcoded values
        // Values are injected during deployment by GitHub Actions workflows
        window.SUPABASE_URL = '${{ secrets.SUPABASE_URL }}';
        window.SUPABASE_ANON_KEY = '${{ secrets.SUPABASE_ANON_KEY }}';
        window.ALCHEMY_API_KEY = '${{ secrets.ALCHEMY_API_KEY }}';
        EOF
        
        echo "✅ Config files generated with values from GitHub Secrets"
        echo "⚠️  These files are NOT committed to the repository - they are generated during deployment only"

