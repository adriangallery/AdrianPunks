# ğŸ” Configurar Nueva API Key de Alchemy

## Nueva ConfiguraciÃ³n

```
Nueva API Key: fgoABFGfYfI7yIPOSW7_bHPiXLQuHPjU
Endpoint: https://base-mainnet.g.alchemy.com/v2/fgoABFGfYfI7yIPOSW7_bHPiXLQuHPjU
```

## âœ… PASO 1: Restringir Dominio en Alchemy (IMPORTANTE)

1. Ve a: **https://dashboard.alchemy.com**
2. Selecciona tu nueva app en Base Mainnet
3. Ve a: **Settings â†’ Security**
4. En **"Allowlist"** o **"HTTP Referrers"**, agrega:
   ```
   https://adriangallery.github.io
   https://*.github.io
   http://localhost:*
   http://127.0.0.1:*
   ```
5. **Guarda los cambios**

**Â¿Por quÃ©?** Esto previene que otros usen tu API key desde sus sitios web.

---

## âœ… PASO 2: Configurar GitHub Secret

### OpciÃ³n A: Via GitHub Web UI (Recomendado)

1. Ve a tu repositorio:
   ```
   https://github.com/adriangallery/AdrianPunks
   ```

2. Click en: **Settings** (del repo)

3. En el menÃº izquierdo: **Secrets and variables â†’ Actions**

4. Click: **"New repository secret"**

5. Agrega/Actualiza el secret:
   ```
   Name: ALCHEMY_API_KEY
   Value: fgoABFGfYfI7yIPOSW7_bHPiXLQuHPjU
   ```

6. Click: **"Add secret"** o **"Update secret"**

### OpciÃ³n B: Via GitHub CLI (Avanzado)

```bash
gh secret set ALCHEMY_API_KEY --body "fgoABFGfYfI7yIPOSW7_bHPiXLQuHPjU"
```

---

## âœ… PASO 3: Crear/Actualizar GitHub Action

Necesitas un workflow que genere `supabase-config.js` automÃ¡ticamente:

### Archivo: `.github/workflows/deploy.yml`

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Generate config file
      run: |
        cat > market/supabase-config.js << EOF
        // Auto-generated by GitHub Actions - DO NOT EDIT
        window.SUPABASE_URL = '${{ secrets.SUPABASE_URL }}';
        window.SUPABASE_ANON_KEY = '${{ secrets.SUPABASE_ANON_KEY }}';
        window.ALCHEMY_API_KEY = '${{ secrets.ALCHEMY_API_KEY }}';
        EOF
        
    - name: Commit and Push
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add market/supabase-config.js
        git diff --quiet && git diff --staged --quiet || git commit -m "ğŸ¤– Auto-update config from secrets"
        git push
```

---

## ğŸš€ OPCIÃ“N RÃPIDA: Actualizar Manualmente Ahora

Si no quieres configurar el workflow todavÃ­a, puedes actualizar manualmente:

### 1. Editar el archivo:

```bash
cd /Users/adrian/Documents/GitHub/AdrianPunks
nano market/supabase-config.js
```

### 2. Reemplazar con:

```javascript
// Auto-generated by GitHub Actions - DO NOT EDIT
window.SUPABASE_URL = 'https://scsxdqudvprtfikkepmu.supabase.co';
window.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjc3hkcXVkdnBydGZpa2tlcG11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MzM0NTUsImV4cCI6MjA3OTAwOTQ1NX0.0li2dAbyh5Ed4FjnZxxr63RSEPlWvsvZ923hBoK8YjY';
window.ALCHEMY_API_KEY = 'fgoABFGfYfI7yIPOSW7_bHPiXLQuHPjU';
```

### 3. Commit y push:

```bash
git add market/supabase-config.js
git commit -m "ğŸ” Actualizar a nueva API key de Alchemy"
git push origin main
```

---

## âš ï¸ IMPORTANTE: .gitignore

Para FUTUROS commits, deberÃ­as ignorar este archivo:

### Agregar a `.gitignore`:

```bash
echo "market/supabase-config.js" >> .gitignore
```

**PERO** por ahora dÃ©jalo en el repo porque GitHub Pages necesita leerlo.

---

## ğŸ” Verificar que Funciona

1. **Espera 2-3 minutos** despuÃ©s del push

2. **Abre tu marketplace:**
   ```
   https://adriangallery.github.io/AdrianPunks/market/
   ```

3. **Abre la consola del navegador** (F12)

4. **DeberÃ­as ver:**
   ```
   âœ… Alchemy API key loaded successfully
   API Key (masked): fgoABFGf...HPjU
   ğŸš€ Iniciando aplicaciÃ³n con optimizaciones...
   ```

5. **NO deberÃ­as ver:**
   ```
   âŒ POST https://base-mainnet.g.alchemy.com/v2/... 429
   ```

---

## ğŸ¯ Resumen de Seguridad

### âœ… Lo que HACE tu configuraciÃ³n actual:

1. **API key visible en el navegador** â†’ Inevitable en frontend
2. **Restricciones de dominio** â†’ Solo tu sitio puede usarla
3. **GitHub Secrets** â†’ No expuesta en el cÃ³digo fuente pÃºblico
4. **Regenerable** â†’ Si se compromete, creas una nueva

### âŒ Lo que NO puede hacer ninguna dApp frontend:

- Ocultar completamente la API key del navegador
- Prevenir que usuarios avanzados la vean
- Proteger contra abuso si no hay restricciones de dominio

### ğŸ›¡ï¸ ProtecciÃ³n Real:

```
Frontend (tu caso):
- Restricciones de dominio en Alchemy âœ…
- Rate limiting en el cÃ³digo âœ…
- Monitoring de uso en Alchemy Dashboard âœ…
- Regenerar key si hay abuso âœ…

Backend (alternativa futura):
- API key nunca expuesta âœ…âœ…âœ…
- Proxy server intermedio
- Rate limiting por usuario
- MÃ¡s complejo de implementar
```

---

## ğŸ“Š Monitoring

DespuÃ©s de actualizar, monitorea en Alchemy Dashboard:

1. **Usage â†’ Requests**
   - Verifica que las requests vienen de tu dominio
   - No deberÃ­as ver picos extraÃ±os

2. **Usage â†’ Compute Units**
   - Monitorea consumo mensual
   - Con Growth tier tienes 3B CU/mes

3. **Settings â†’ Security â†’ Activity**
   - Verifica requests por referrer
   - Todo deberÃ­a ser desde tu GitHub Pages

---

## ğŸ†˜ Si Hay Problemas

### Error 403 (Forbidden):
- Verifica restricciones de dominio
- AsegÃºrate de incluir `https://adriangallery.github.io`

### Error 429 sigue apareciendo:
- Espera 5 minutos despuÃ©s de crear la app
- Verifica plan en Dashboard (debe ser Growth+)
- Confirma que la nueva key estÃ¡ en uso

### API key no funciona:
- Regenera la key en Dashboard
- Actualiza el secret en GitHub
- Re-deploy

---

**Fecha:** 2025-11-20  
**Estado:** ConfiguraciÃ³n lista para implementar  
**Prioridad:** ğŸ”´ ALTA - Hacer ANTES de usar el marketplace

